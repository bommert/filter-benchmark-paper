library(ggplot2)
library(data.table)

load("../Results/data_n_feats.RData")

# generated by filter_benchmark_results_stability.R
load("../Results/results_stability.RData")

# generated in filter_benchmark_rank_cors.R
load("mean_cor.RData")

# make the maximum 1
s1 = function(x) {
  return(x + 1 - max(x, na.rm = TRUE))
}

# rename filters
rename.filters = function(n) {
  n2 = strsplit(n, "FSelectorRcpp.")
  n2a = unlist(lapply(n2, function(x) x[length(x)]))

  n3 = strsplit(n2a, "praznik.")
  n3a = unlist(lapply(n3, function(x) x[length(x)]))

  n4 = strsplit(n3a, "ranger.")
  n4a = unlist(lapply(n4, function(x) x[length(x)]))

  n5 = ifelse(n4a == "gainratio", "gain.ratio", n4a)
  n5 = ifelse(n5 == "infogain", "info.gain", n5)
  n5 = ifelse(n5 == "symuncert", "sym.uncert", n5)

  return(n5)
}

results.stability$fw.method = rename.filters(results.stability$fw.method)


##########################################################################################

results.stability = results.stability[!is.na(stability), ]

stab.trafo = results.stability[, list(stability = s1(stability), fw.method = fw.method), by = c("dataname")]

stab.medians = stab.trafo[, list(median = median(stability)), by = "fw.method"]
o = order(stab.medians$median, decreasing = TRUE)
names.o = stab.medians$fw.method[o]
stab.trafo$fw.method = droplevels(factor(stab.trafo$fw.method, levels = names.o))

pdf("../Plots/stability.pdf", height = 6, width = 8)
gg = ggplot(data = stab.trafo, mapping = aes(x = fw.method, y = stability)) +
  theme_bw() +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
    axis.text = element_text(size = 13),
    axis.title = element_text(size = 13.5)) +
  ylab("Relative stability") +
  xlab("Filter method")
print(gg)
dev.off()
